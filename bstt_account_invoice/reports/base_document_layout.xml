<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- تقرير QWeb: External Layout + جدول الفاتورة -->
        <template id="external_layout_invoice" inherit_id="web.external_layout_standard">

            <!-- Header -->
            <xpath expr="//div[@t-attf-class='header o_company_#{company.id}_layout']" position="replace">
                <div t-attf-class="header o_company_#{company.id}_layout" t-att-style="report_header_style">
                    <div class="row" style="font-weight: bold;font-size: small;border-bottom: 1px solid black;direction: rtl;">
                        <div class="col-5 text-center" style="text-align:left;">
                            <h4 class="mt0" t-field="company.report_header" style="text-align:right;"/>
                            <ul class="list-inline" style="text-align:right;">
                                <li><span t-field="company.name"/></li>
                                <li>ذات مسؤلية محدودة</li>
                                <li>رأس المال المدفوع (1200000) ريال سعودي</li>
                                <li>المركز الرئيسي الرياض - المملكة العربية السعودية</li>
                                <li>الرقم الضريبي <span t-field="company.vat"/></li>
                                <li>رقم سجل الشركة <span t-field="company.company_registry"/></li>
                            </ul>
                        </div>
                        <div class="col-2 text-center">
                            <img t-if="company.logo" t-att-src="image_data_uri(company.logo)"
                                 style="height: 130px;width: 200px;display:block;margin-left:-50px;" alt="Logo"/>
                        </div>
                        <div class="col-5 text-center" style="text-align:right;">
                            <ul class="list-inline" style="text-align:left;">
                                <li><span t-field="company.foreign_name"/></li>
                                <li>Liability of Member Limited</li>
                                <li>Capital Paid (1200000) S.R</li>
                                <li>Head Office - Riyadh - Kingdom of Saudi Arabia</li>
                                <li t-if="company.partner_id.vat">
                                    <t t-esc="o.company_id.country_id.vat_label or 'Tax ID'"/>:
                                    <span t-field="company.partner_id.vat"/>
                                </li>
                                <li>CR No: <span t-field="company.company_registry"/></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </xpath>

            <!-- Footer -->
            <xpath expr="//div[@t-call='web.external_layout_footer']" position="replace">
                <div class="text-center" style="font-size: small;border-top: 1px solid black;">
                    <ul class="list-inline mb4">
                        <li><span class="o_force_rtl">س.ت 1010076127 - ص.ب 4630 الرياض 11412 - تليفون: 4566883 - فاكس: 4565222</span></li>
                        <li><span class="o_force_ltr">C.R. 1001076127 - P.O. Box 4630 Riyadh 11412 - Tel. 4566883 - Fax 4565222</span></li>
                        <li t-if="company.email"><span class="o_force_ltr" t-field="company.email"/></li>
                    </ul>
                    <div t-if="report_type == 'pdf'" class="text-muted">
                        <div class="row">
                            <div class="col-6 text-right">Page/صفحة:</div>
                            <div class="col-6 text-left pl-0"><span class="page"/> / <span class="topage"/></div>
                        </div>
                    </div>
                </div>
            </xpath>

            <!-- جدول الفاتورة -->
            <xpath expr="//div[@class='article']" position="after">
                <div class="table-responsive mt-4">
                    <table class="table table-sm table-bordered" style="width:100%;border-collapse:collapse;">
                        <thead style="background-color:#f2f2f2;">
                        <tr>
                            <th style="text-align:center;">#</th>
                            <th style="text-align:center;">المنتج / Product</th>
                            <th style="text-align:center;">الوصف / Description</th>
                            <th style="text-align:center;">الكمية / Qty</th>
                            <th style="text-align:center;">الوحدة / Unit</th>
                            <th style="text-align:center;">سعر الوحدة / Unit Price</th>
                            <th style="text-align:center;">الخصم / Discount</th>
                            <th style="text-align:center;">الضريبة / Tax</th>
                            <th style="text-align:center;">الإجمالي / Total</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr t-foreach="o.invoice_line_ids" t-as="line">
                            <td style="text-align:center;"><t t-esc="line.sequence"/></td>
                            <td><t t-esc="line.product_id.name"/></td>
                            <td><t t-esc="line.name"/></td>
                            <td style="text-align:center;"><t t-esc="line.quantity"/></td>
                            <td style="text-align:center;"><t t-esc="line.uom_id.name"/></td>
                            <td style="text-align:right;"><t t-esc="line.price_unit"/></td>
                            <td style="text-align:right;"><t t-esc="line.discount"/>%</td>
                            <td style="text-align:right;">
                                <t t-foreach="line.tax_ids" t-as="tax">
                                    <t t-esc="tax.name"/> (<t t-esc="tax.amount"/>%)<br/>
                                </t>
                            </td>
                            <td style="text-align:right;"><t t-esc="line.price_subtotal"/></td>
                        </tr>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="8" style="text-align:right;font-weight:bold;">المجموع / Total</td>
                            <td style="text-align:right;font-weight:bold;"><t t-esc="o.amount_total"/></td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </xpath>

        </template>
    </data>
</odoo>
