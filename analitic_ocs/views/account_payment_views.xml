<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Payment Form View -->
        <record id="view_account_payment_form_rental" model="ir.ui.view">
            <field name="name">account.payment.form.rental</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_form"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="rental_order_id" 
                           attrs="{'invisible': [('payment_type', '!=', 'inbound')]}"
                           options="{'no_create': True, 'no_edit': True}"/>
                </field>
                
                <!-- إضافة الحقول في نهاية النموذج -->
                <field name="amount" position="after">
                    <separator string="Rental Order Details" 
                              attrs="{'invisible': [('rental_order_id', '=', False)]}"/>
                    
                    <group string="Related Rental Invoices" 
                           attrs="{'invisible': [('rental_order_id', '=', False)]}">
                        <field name="rental_invoice_ids" nolabel="1" readonly="1">
                            <tree>
                                <field name="name"/>
                                <field name="partner_id"/>
                                <field name="invoice_date"/>
                                <field name="amount_total"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </group>
                    
                    <group string="Analytical Accounts from Invoices" 
                           attrs="{'invisible': [('rental_order_id', '=', False)]}">
                        <field name="rental_invoice_ids" nolabel="1" mode="tree" readonly="1">
                            <tree>
                                <field name="name"/>
                                <field name="invoice_line_ids">
                                    <tree>
                                        <field name="product_id"/>
                                        <field name="analytic_account_id"/>
                                        <field name="price_subtotal"/>
                                    </tree>
                                </field>
                            </tree>
                        </field>
                    </group>
                </field>
            </field>
        </record>
        
        <!-- Payment Tree View -->
        <record id="view_account_payment_tree_rental" model="ir.ui.view">
            <field name="name">account.payment.tree.rental</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_tree"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="rental_order_id" optional="hide"/>
                </field>
            </field>
        </record>
    </data>
</odoo>
