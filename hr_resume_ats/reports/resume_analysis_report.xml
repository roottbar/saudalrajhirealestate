<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Resume Analysis Report Template -->
        <template id="resume_analysis_report_template">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="analysis">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <!-- Header -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h2 class="text-center mb-3">
                                        <strong>Resume Analysis Report</strong>
                                    </h2>
                                    <div class="text-center text-muted">
                                        Analysis Date: <span t-field="analysis.analysis_date" t-options="{'widget': 'date'}"/>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Candidate Information -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4 class="border-bottom pb-2 mb-3">Candidate Information</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Name:</strong></td>
                                                    <td><span t-field="analysis.candidate_name"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Email:</strong></td>
                                                    <td><span t-field="analysis.candidate_email"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Phone:</strong></td>
                                                    <td><span t-field="analysis.candidate_phone"/></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="col-6">
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Resume File:</strong></td>
                                                    <td><span t-field="analysis.resume_filename"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Analysis Status:</strong></td>
                                                    <td><span t-field="analysis.state"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Years of Experience:</strong></td>
                                                    <td><span t-field="analysis.total_experience_years"/> years</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Job Position Information -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4 class="border-bottom pb-2 mb-3">Applied Position</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Position:</strong></td>
                                                    <td><span t-field="analysis.job_position_id.name"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Department:</strong></td>
                                                    <td><span t-field="analysis.job_position_id.department_id.name"/></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="col-6">
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Required Experience:</strong></td>
                                                    <td><span t-field="analysis.job_position_id.required_experience_years"/> years</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Required Education:</strong></td>
                                                    <td><span t-field="analysis.job_position_id.required_education_level"/></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Overall Score -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4 class="border-bottom pb-2 mb-3">Overall Assessment</h4>
                                    <div class="text-center mb-3">
                                        <div class="d-inline-block p-4 border rounded" style="background-color: #f8f9fa;">
                                            <h1 class="display-4 mb-0" t-att-style="'color: ' + ('green' if analysis.overall_score >= 70 else 'orange' if analysis.overall_score >= 50 else 'red')">
                                                <span t-field="analysis.overall_score" t-options="{'widget': 'float', 'precision': 1}"/>%
                                            </h1>
                                            <p class="text-muted mb-0">Overall Match Score</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Score Breakdown -->
                                    <div class="row">
                                        <div class="col-3 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-field="analysis.ats_compatibility_score" t-options="{'widget': 'float', 'precision': 1}"/>%
                                                <p class="text-muted mb-0">ATS Score</p>
                                            </div>
                                        </div>
                                        <div class="col-3 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-field="analysis.skills_match_score" t-options="{'widget': 'float', 'precision': 1}"/>%
                                                <p class="text-muted mb-0">Skills Match</p>
                                            </div>
                                        </div>
                                        <div class="col-3 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-field="analysis.experience_score" t-options="{'widget': 'float', 'precision': 1}"/>%
                                                <p class="text-muted mb-0">Experience</p>
                                            </div>
                                        </div>
                                        <div class="col-3 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-field="analysis.education_score" t-options="{'widget': 'float', 'precision': 1}"/>%
                                                <p class="text-muted mb-0">Education</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Skills Analysis -->
                            <t t-if="analysis.skill_ids">
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h4 class="border-bottom pb-2 mb-3">Skills Analysis</h4>
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Skill</th>
                                                    <th>Category</th>
                                                    <th>Found</th>
                                                    <th>Relevance Score</th>
                                                    <th>Level</th>
                                                    <th>Mentions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="analysis.skill_ids" t-as="skill">
                                                    <tr>
                                                        <td><span t-field="skill.skill_name"/></td>
                                                        <td><span t-field="skill.skill_category"/></td>
                                                        <td>
                                                            <span t-if="skill.is_found" class="badge badge-success">✓</span>
                                                            <span t-else="" class="badge badge-danger">✗</span>
                                                        </td>
                                                        <td><span t-field="skill.relevance_score" t-options="{'widget': 'float', 'precision': 1}"/>%</td>
                                                        <td><span t-field="skill.skill_level"/></td>
                                                        <td><span t-field="skill.mentions_count"/></td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </t>
                            
                            <!-- Experience Analysis -->
                            <t t-if="analysis.experience_ids">
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h4 class="border-bottom pb-2 mb-3">Experience Analysis</h4>
                                        <t t-foreach="analysis.experience_ids" t-as="exp">
                                            <div class="card mb-3">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-8">
                                                            <h5 class="card-title"><span t-field="exp.position_title"/></h5>
                                                            <h6 class="card-subtitle mb-2 text-muted"><span t-field="exp.company_name"/></h6>
                                                            <p class="card-text"><span t-field="exp.description"/></p>
                                                        </div>
                                                        <div class="col-4">
                                                            <table class="table table-borderless table-sm">
                                                                <tr>
                                                                    <td><strong>Duration:</strong></td>
                                                                    <td><span t-field="exp.duration_years" t-options="{'widget': 'float', 'precision': 1}"/> years</td>
                                                                </tr>
                                                                <tr>
                                                                    <td><strong>Relevance:</strong></td>
                                                                    <td><span t-field="exp.relevance_score" t-options="{'widget': 'float', 'precision': 1}"/>%</td>
                                                                </tr>
                                                                <tr>
                                                                    <td><strong>Level:</strong></td>
                                                                    <td><span t-field="exp.seniority_level"/></td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </t>
                            
                            <!-- Education Analysis -->
                            <t t-if="analysis.education_ids">
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h4 class="border-bottom pb-2 mb-3">Education Analysis</h4>
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Degree</th>
                                                    <th>Field of Study</th>
                                                    <th>Institution</th>
                                                    <th>Year</th>
                                                    <th>Level</th>
                                                    <th>Relevance</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="analysis.education_ids" t-as="edu">
                                                    <tr>
                                                        <td><span t-field="edu.degree_name"/></td>
                                                        <td><span t-field="edu.field_of_study"/></td>
                                                        <td><span t-field="edu.institution_name"/></td>
                                                        <td><span t-field="edu.graduation_year"/></td>
                                                        <td><span t-field="edu.education_level"/></td>
                                                        <td><span t-field="edu.relevance_score" t-options="{'widget': 'float', 'precision': 1}"/>%</td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </t>
                            
                            <!-- Analysis Summary -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4 class="border-bottom pb-2 mb-3">Analysis Summary</h4>
                                    <div class="card">
                                        <div class="card-body">
                                            <div t-field="analysis.analysis_summary" class="card-text"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recommendations -->
                            <t t-if="analysis.recommendations">
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h4 class="border-bottom pb-2 mb-3">Recommendations</h4>
                                        <div class="card">
                                            <div class="card-body">
                                                <p t-field="analysis.recommendations" class="card-text"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                            
                            <!-- Footer -->
                            <div class="row mt-5">
                                <div class="col-12 text-center text-muted">
                                    <small>
                                        Report generated by HR Resume ATS System on 
                                        <span t-esc="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
        
        <!-- Report Action -->
        <record id="action_resume_analysis_report" model="ir.actions.report">
            <field name="name">Resume Analysis Report</field>
            <field name="model">hr.resume.analysis</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">hr_resume_ats.resume_analysis_report_template</field>
            <field name="report_file">hr_resume_ats.resume_analysis_report_template</field>
            <field name="binding_model_id" ref="base.model_hr_resume_analysis"/>
            <field name="binding_type">report</field>
        </record>
        
    </data>
</odoo>