<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- إضافة الحقول والأزرار المطلوبة لنموذج sale.order -->
        <record id="view_order_form_compatibility_fix" model="ir.ui.view">
            <field name="name">sale.order.form.compatibility.fix</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <!-- إضافة الحقول المخفية للتوافق -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="transferred_id" invisible="1"/>
                    <field name="locked" invisible="1"/>
                    <field name="authorized_transaction_ids" invisible="1"/>
                    <field name="subscription_state" invisible="1"/>
                </xpath>
                
                <!-- إضافة الأزرار في منطقة الرأس -->
                <xpath expr="//header" position="inside">
                    <button name="payment_action_capture" 
                            type="object" 
                            data-hotkey="shift+g" 
                            string="Capture Transaction" 
                            class="oe_highlight" 
                            attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                    
                    <button name="payment_action_void" 
                            type="object" 
                            string="Void Transaction" 
                            data-hotkey="shift+v" 
                            confirm="Are you sure you want to void the authorized transaction? This action can't be undone." 
                            attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                    
                    <button string="Resume" 
                            name="resume_subscription" 
                            type="object" 
                            data-hotkey="r" 
                            class="btn-primary" 
                            attrs="{'invisible': [('subscription_state', '!=', '4_paused')]}"/>
                </xpath>
            </field>
        </record>
        
        <!-- إضافة الحقول في عرض الشجرة للتوافق -->
        <record id="view_quotation_tree_compatibility_fix" model="ir.ui.view">
            <field name="name">sale.order.tree.compatibility.fix</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="transferred_id" invisible="1"/>
                    <field name="locked" invisible="1"/>
                    <field name="subscription_state" invisible="1"/>
                </xpath>
            </field>
        </record>
        
        <!-- إضافة الحقول في عرض البحث للتوافق -->
        <record id="view_sales_order_filter_compatibility_fix" model="ir.ui.view">
            <field name="name">sale.order.search.compatibility.fix</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//search" position="inside">
                    <field name="transferred_id"/>
                    <field name="subscription_state"/>
                    <filter string="Locked Orders" name="locked" domain="[('locked', '=', True)]"/>
                    <filter string="Active Subscriptions" name="active_subscriptions" domain="[('subscription_state', '=', '2_active')]"/>
                    <filter string="Paused Subscriptions" name="paused_subscriptions" domain="[('subscription_state', '=', '4_paused')]"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>